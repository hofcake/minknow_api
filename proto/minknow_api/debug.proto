syntax="proto3";

package minknow_api.debug;

option java_package = "com.nanoporetech.minknow_api";
option objc_class_prefix = "MKAPI";
option go_package ="github.com/nanoporetech/minknow_api/go/gen/debug";

import "minknow_api/rpc_options.proto";
import "google/protobuf/duration.proto";
import "google/protobuf/wrappers.proto";

service DebugService {

    // Returns the state of the basecall client
    rpc get_basecall_clients_states (GetBasecallClientState) returns (GetBasecallClientResponse) {
        option idempotency_level = NO_SIDE_EFFECTS;
    }

     // Returns the state of the basecall server
   rpc get_basecaller_server_state (GetBasecallServerState) returns (GetBasecallServerResponse) {
        option idempotency_level = NO_SIDE_EFFECTS;
    }

    // Disconnect flow cell at a position
    // Preconditions:
    // - the position is a simulated position
    // The call is ignored if the flow cell at that position is already disconnected
    rpc disconnect_flow_cell(DisconnectFlowCellRequest) returns (DisconnectFlowCellResponse) {}

    // Connect flow cell at a position
    // Preconditions:
    // - the position is a simulated position
    // The call is ignored if the position already has a flow cell connected
    rpc connect_flow_cell(ConnectFlowCellRequest) returns (ConnectFlowCellResponse) {}

    // Simulate frame loss for a specified amount of time
    // The request will only trigger the frame loss once during
    // the next initiated acquisition.
    // Preconditions:
    // - The position must be a simulated position
    // - An acquisition must not already be in progress
    rpc simulate_frame_loss(SimulateFrameLossRequest) returns (SimulateFrameLossResponse) {}
}

message GetBasecallClientState {}

message GetBasecallClientResponse {
    // This debug string with internal debug data, in practice it generally a JSON-formatted string.
   repeated string client_state = 1;
}

message GetBasecallServerState {}

message GetBasecallServerResponse {
    // This debug string with internal debug data, in practice it generally a JSON-formatted string.
   string server_state = 1;
}

message DisconnectFlowCellRequest {}
message DisconnectFlowCellResponse {}
message ConnectFlowCellRequest {}
message ConnectFlowCellResponse {}

message SimulateFrameLossRequest {
    // The duration for which the frame loss will occur.
    google.protobuf.Duration frame_loss_duration = 1;

    // The frame index from which the frame loss will begin
    //
    // For simulated PromethIONs this equates to the frame index within a section
    uint64 start_frame = 3;

    // Optional section index from which the frame loss will begin
    //
    // For simulated PromethIONs a section equates to a completed scatterlist
    optional uint64 start_section = 4;

    // Optional number of times to repeat the failed transfers
    //
    // This will reset the frame loss on starting a new acquisition or
    // resuming acquisition on an existing signal reader.
    optional uint64 repeats = 5;
}

message SimulateFrameLossResponse {}
